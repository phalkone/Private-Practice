<table class="week">
  <thead>
    <tr>
      <th></th>
      <% @next = @begin %>
      <% y = (@weekend == "1")? 6 : 4 %>
      <% for i in 0..y %>
        <th><%= l(@next, :format => :only_day_name) %><br />
             <%= l(@next, :format => :short_date) %></th>
        <% @next = @next.tomorrow %>
      <% end %>
    <tr>
  </thead>
  <tbody>
    <% for i in 0..((@stop-@start)-1) %>
    <tr>
      <% hour = i + @start %>
      <td class="hour"><span class="big"><%= (hour.to_s.length < 2) ? "0" + hour.to_s : hour %></span><span class="superscript">00</span></td>
      <% @next = @begin %>
      <% for i2 in 0..y %>
        <% if !@weekarray[i][i2].nil? %>
          <% @apps = @weekarray[i][i2].split(";") %>
          <td class="<%= (@weekend == "1")? "weekend" : "no_weekend" %>"><% @apps.each() do |a| %>
            <% app = @appointments.find_by_id(a.to_i) %>
            <div class="app"><%= l(app.begin, :format => :time) %> <%= link_to app.patient.name, appointment_path(app), :title => app.patient.name, :remote => true %></div>
          <% end %></td>
        <% else %>
          <td class="<%= (@weekend == "1")? "weekend" : "no_weekend" %>"></td>
        <% end %>
        <% @next = @next.tomorrow %>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
